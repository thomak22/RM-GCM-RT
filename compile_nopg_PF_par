#!/bin/bash -x

rm -f igcm3_nopg_par

# directory to run the model in
PRUNDIR='Planet_Run_PF_par'

OPT='-O3 -xHost'
#OPT='-Ofast -xHost'
PROF='-g -p'
REPORT='-warn noalign'
PARALLEL='-fopenmp'
OTHER_OPTS='-debug extended'
cp params.iPF params.i

# First compile module file(s)
ifort -c -g $OPT $REPORT $PARALLEL $OTHER_OPTS -r8 -132 -traceback corrk.f
# Then the main program and subroutines
ifort -c -g $OPT $REPORT $PARALLEL $OTHER_OPTS -r8 -132 -traceback double-gray-ropprmulti.f radiative_transfer_picket_fence.f cmltri_nopg.f cbalanc.f cblayer.f cblsurf.f ccalndr.f ccbadj.f ccbcon.f ccldtrn.f ccolamt.f cconvec.f ccubm.f ccudif.f cdanalv.f cdedd.f cdgrmlt.f cdifuse.f cdlsgcr.f cdryadj.f cdstep.f cenergy.f chanal.f chanal1.f chanalv.f chexp.f chexp1.f chexpv.f cictrac.f cinibal.f cinigau.f ciniphys.f ciniqs.f cinires.f ciniresij.f ciniset.f cinisi.f cinisp.f cinistr.f cinisurf.f inisimprad.f inivarparam.f cinital.f cinterp.f cirrad.f clgndre.f clscrn.f cltd.f cltddia.f clti.f cltidt.f cmascor.f cmatinv.f cmgrmlt.f cnikos.f cnoise.f co3interp.f cpqsat.f cpvcr.f cradsw.f csetres.f csettee.f csetzt.f csfct.f cspdel2.f cspop.f csurfm.f csw.f cswtt.f ctbal.f ctstep.f cvdiff.f cwrsps.f cxsect.f cfft991.f cssum.f csdot.f cicamax.f  cgwtlt.f cset99.f cqreig.f csgetrf.f csgetri.f csgemm.f crpassm.f cqpassm.f chessen.f cqrt.f cxerbla.f cilaenv.f csgetf2.f cslaswp.f cstrsm.f cstrtri.f csgemv.f csswap.f clsame.f cisamax.f csscal.f csger.f cstrmm.f cstrti2.f cstrmv.f cranf.f xsect2.f xsect3.f filecopy.f finalorb.f Binary.f rradiation.f rcalc_radheat.f rradsub.f rsetuprad_simple.f rradtran.f rinterpol.f roppr1.f rtwostr.f radd.f rnewflux1.f rmakeclouds.f ropprmulti.f cloud_properties_set_up.f radiative_transfer_corrk.f corrk_setup.f roppr1_corrk.f
# Then link the two together to create the executable
ifort -g $OPT $REPORT $PARALLEL $OTHER_OPTS -r8 -132 -traceback -o igcm3_nopg_par corrk.o double-gray-ropprmulti.o radiative_transfer_picket_fence.o cmltri_nopg.o cbalanc.o cblayer.o cblsurf.o ccalndr.o ccbadj.o ccbcon.o ccldtrn.o ccolamt.o cconvec.o ccubm.o ccudif.o cdanalv.o cdedd.o cdgrmlt.o cdifuse.o cdlsgcr.o cdryadj.o cdstep.o cenergy.o chanal.o chanal1.o chanalv.o chexp.o chexp1.o chexpv.o cictrac.o cinibal.o cinigau.o ciniphys.o ciniqs.o cinires.o ciniresij.o ciniset.o cinisi.o cinisp.o cinistr.o cinisurf.o inisimprad.o inivarparam.o cinital.o cinterp.o cirrad.o clgndre.o clscrn.o cltd.o cltddia.o clti.o cltidt.o cmascor.o cmatinv.o cmgrmlt.o cnikos.o cnoise.o co3interp.o cpqsat.o cpvcr.o cradsw.o csetres.o csettee.o csetzt.o csfct.o cspdel2.o cspop.o csurfm.o csw.o cswtt.o ctbal.o ctstep.o cvdiff.o cwrsps.o cxsect.o cfft991.o cssum.o csdot.o cicamax.o  cgwtlt.o cset99.o cqreig.o csgetrf.o csgetri.o csgemm.o crpassm.o cqpassm.o chessen.o cqrt.o cxerbla.o cilaenv.o csgetf2.o cslaswp.o cstrsm.o cstrtri.o csgemv.o csswap.o clsame.o cisamax.o csscal.o csger.o cstrmm.o cstrti2.o cstrmv.o cranf.o xsect2.o xsect3.o filecopy.o finalorb.o Binary.o rradiation.o rcalc_radheat.o rradsub.o rsetuprad_simple.o rradtran.o rinterpol.o roppr1.o rtwostr.o radd.o rnewflux1.o rmakeclouds.o ropprmulti.o cloud_properties_set_up.o radiative_transfer_corrk.o corrk_setup.o roppr1_corrk.o
# Clean up the .o files
rm *.o


rm -r $PRUNDIR
mkdir $PRUNDIR
cp igcm3_nopg_par $PRUNDIR
cp fort.7PF $PRUNDIR/fort.7
cd $PRUNDIR
(time ./igcm3_nopg_par) 2> runtime.txt